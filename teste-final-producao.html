<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Final - Doce Sensa√ß√µes</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .test-card {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        .test-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .test-card.success { border-color: #4CAF50; background-color: #f1f8e9; }
        .test-card.error { border-color: #f44336; background-color: #ffebee; }
        .test-card.loading { border-color: #2196F3; background-color: #e3f2fd; }
        .test-card.warning { border-color: #ff9800; background-color: #fff3e0; }
        
        .test-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-block;
        }
        .status-success { background: #4CAF50; }
        .status-error { background: #f44336; }
        .status-loading { background: #2196F3; }
        .status-warning { background: #ff9800; }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            transition: transform 0.2s;
        }
        button:hover { transform: translateY(-2px); }
        button:disabled { opacity: 0.6; cursor: not-allowed; }
        
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 150px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .summary {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .summary h3 {
            color: #333;
            margin-bottom: 15px;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .summary-item:last-child {
            border-bottom: none;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            transition: width 0.3s ease;
        }
        
        .action-buttons {
            text-align: center;
            margin-top: 30px;
        }
        
        .action-btn {
            background: #4CAF50;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }
        
        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(76, 175, 80, 0.3);
        }
        
        .action-btn.secondary {
            background: #2196F3;
        }
        
        .action-btn.secondary:hover {
            box-shadow: 0 10px 20px rgba(33, 150, 243, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ Teste Final - Doce Sensa√ß√µes</h1>
            <p>Verificando se o sistema est√° pronto para produ√ß√£o</p>
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
        </div>
        
        <div class="test-grid">
            <div class="test-card" id="api-test">
                <div class="test-title">
                    <span class="status-icon status-loading"></span>
                    üåê API Backend
                </div>
                <p>Testando conectividade e endpoints da API</p>
                <button onclick="testAPI()">Testar API</button>
                <div class="result" id="api-result">Aguardando teste...</div>
            </div>
            
            <div class="test-card" id="auth-test">
                <div class="test-title">
                    <span class="status-icon status-loading"></span>
                    üîê Autentica√ß√£o
                </div>
                <p>Testando login e registro de usu√°rios</p>
                <button onclick="testAuth()">Testar Login</button>
                <div class="result" id="auth-result">Aguardando teste...</div>
            </div>
            
            <div class="test-card" id="products-test">
                <div class="test-title">
                    <span class="status-icon status-loading"></span>
                    üç∞ Produtos
                </div>
                <p>Testando carregamento de produtos</p>
                <button onclick="testProducts()">Testar Produtos</button>
                <div class="result" id="products-result">Aguardando teste...</div>
            </div>
            
            <div class="test-card" id="cors-test">
                <div class="test-title">
                    <span class="status-icon status-loading"></span>
                    üîó CORS
                </div>
                <p>Testando comunica√ß√£o entre frontend e backend</p>
                <button onclick="testCORS()">Testar CORS</button>
                <div class="result" id="cors-result">Aguardando teste...</div>
            </div>
            
            <div class="test-card" id="frontend-test">
                <div class="test-title">
                    <span class="status-icon status-loading"></span>
                    üé® Frontend
                </div>
                <p>Testando interface e responsividade</p>
                <button onclick="testFrontend()">Testar Frontend</button>
                <div class="result" id="frontend-result">Aguardando teste...</div>
            </div>
            
            <div class="test-card" id="database-test">
                <div class="test-title">
                    <span class="status-icon status-loading"></span>
                    üíæ Banco de Dados
                </div>
                <p>Testando conex√£o e dados</p>
                <button onclick="testDatabase()">Testar Banco</button>
                <div class="result" id="database-result">Aguardando teste...</div>
            </div>
        </div>
        
        <div class="summary">
            <h3>üìä Resumo dos Testes</h3>
            <div class="summary-item">
                <span>API Backend:</span>
                <span id="api-summary">‚è≥ Testando...</span>
            </div>
            <div class="summary-item">
                <span>Autentica√ß√£o:</span>
                <span id="auth-summary">‚è≥ Testando...</span>
            </div>
            <div class="summary-item">
                <span>Produtos:</span>
                <span id="products-summary">‚è≥ Testando...</span>
            </div>
            <div class="summary-item">
                <span>CORS:</span>
                <span id="cors-summary">‚è≥ Testando...</span>
            </div>
            <div class="summary-item">
                <span>Frontend:</span>
                <span id="frontend-summary">‚è≥ Testando...</span>
            </div>
            <div class="summary-item">
                <span>Banco de Dados:</span>
                <span id="database-summary">‚è≥ Testando...</span>
            </div>
            <div class="summary-item" style="font-weight: bold; margin-top: 10px;">
                <span>Status Geral:</span>
                <span id="overall-status">‚è≥ Executando testes...</span>
            </div>
        </div>
        
        <div class="action-buttons">
            <button class="action-btn" onclick="runAllTests()">üöÄ Executar Todos os Testes</button>
            <button class="action-btn secondary" onclick="openProductionSite()">üåê Abrir Site de Produ√ß√£o</button>
            <button class="action-btn secondary" onclick="generateReport()">üìã Gerar Relat√≥rio</button>
        </div>
    </div>

    <script>
        const API_BASE = 'https://docesensacoes-2.onrender.com/api';
        let testResults = {};
        let completedTests = 0;
        const totalTests = 6;
        
        function updateProgress() {
            const progress = (completedTests / totalTests) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
        }
        
        function updateTestCard(testId, status, message) {
            const card = document.getElementById(testId);
            const icon = card.querySelector('.status-icon');
            const result = document.getElementById(testId.replace('-test', '-result'));
            const summary = document.getElementById(testId.replace('-test', '-summary'));
            
            // Remover classes anteriores
            card.className = 'test-card';
            icon.className = 'status-icon';
            
            // Adicionar nova classe
            card.classList.add(status);
            icon.classList.add('status-' + status);
            
            // Atualizar resultado
            result.textContent = message;
            
            // Atualizar resumo
            const statusText = {
                'success': '‚úÖ Funcionando',
                'error': '‚ùå Erro',
                'warning': '‚ö†Ô∏è Aten√ß√£o',
                'loading': '‚è≥ Testando...'
            };
            summary.textContent = statusText[status];
            
            // Contar testes completos
            if (status !== 'loading') {
                completedTests++;
                updateProgress();
                updateOverallStatus();
            }
        }
        
        function updateOverallStatus() {
            const statusElement = document.getElementById('overall-status');
            const successCount = Object.values(testResults).filter(r => r === 'success').length;
            const errorCount = Object.values(testResults).filter(r => r === 'error').length;
            const warningCount = Object.values(testResults).filter(r => r === 'warning').length;
            
            if (completedTests === totalTests) {
                if (errorCount === 0 && warningCount === 0) {
                    statusElement.textContent = 'üéâ PRONTO PARA PRODU√á√ÉO!';
                    statusElement.style.color = '#4CAF50';
                } else if (errorCount === 0) {
                    statusElement.textContent = '‚úÖ FUNCIONAL (com avisos)';
                    statusElement.style.color = '#ff9800';
                } else {
                    statusElement.textContent = '‚ùå NECESSITA CORRE√á√ïES';
                    statusElement.style.color = '#f44336';
                }
            }
        }
        
        async function makeRequest(endpoint, method = 'GET', data = null) {
            try {
                const url = API_BASE + endpoint;
                const options = {
                    method: method,
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                };

                if (data && method !== 'GET') {
                    options.body = JSON.stringify(data);
                }

                const response = await fetch(url, options);
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                throw error;
            }
        }
        
        async function testAPI() {
            updateTestCard('api-test', 'loading', 'Testando API...');
            
            try {
                const data = await makeRequest('/test');
                testResults.api = 'success';
                updateTestCard('api-test', 'success', 
                    `‚úÖ API funcionando!\nStatus: ${data.status}\nMensagem: ${data.message}\nTimestamp: ${data.timestamp}`
                );
            } catch (error) {
                testResults.api = 'error';
                updateTestCard('api-test', 'error', `‚ùå Erro na API: ${error.message}`);
            }
        }
        
        async function testAuth() {
            updateTestCard('auth-test', 'loading', 'Testando autentica√ß√£o...');
            
            try {
                const data = await makeRequest('/auth/login', 'POST', {
                    email: 'admin@docesensacoes.com',
                    password: 'admin123'
                });
                
                testResults.auth = 'success';
                updateTestCard('auth-test', 'success', 
                    `‚úÖ Login funcionando!\nUsu√°rio: ${data.data.user.name}\nEmail: ${data.data.user.email}\nToken: ${data.data.token ? 'Recebido' : 'N√£o recebido'}`
                );
            } catch (error) {
                testResults.auth = 'error';
                updateTestCard('auth-test', 'error', `‚ùå Erro na autentica√ß√£o: ${error.message}`);
            }
        }
        
        async function testProducts() {
            updateTestCard('products-test', 'loading', 'Carregando produtos...');
            
            try {
                const data = await makeRequest('/products');
                const products = data.data || data;
                
                if (products && products.length > 0) {
                    testResults.products = 'success';
                    updateTestCard('products-test', 'success', 
                        `‚úÖ Produtos carregados!\nQuantidade: ${products.length}\nPrimeiros produtos:\n${products.slice(0, 3).map(p => `- ${p.name}: R$ ${p.price}`).join('\n')}`
                    );
                } else {
                    testResults.products = 'warning';
                    updateTestCard('products-test', 'warning', '‚ö†Ô∏è API respondeu, mas n√£o h√° produtos cadastrados');
                }
            } catch (error) {
                testResults.products = 'error';
                updateTestCard('products-test', 'error', `‚ùå Erro ao carregar produtos: ${error.message}`);
            }
        }
        
        async function testCORS() {
            updateTestCard('cors-test', 'loading', 'Testando CORS...');
            
            try {
                const response = await fetch(`${API_BASE}/test`, {
                    method: 'OPTIONS',
                    headers: {
                        'Origin': window.location.origin,
                        'Access-Control-Request-Method': 'GET',
                        'Access-Control-Request-Headers': 'Content-Type'
                    }
                });
                
                testResults.cors = 'success';
                updateTestCard('cors-test', 'success', 
                    `‚úÖ CORS configurado!\nStatus: ${response.status}\nOrigin permitido: ${window.location.origin}`
                );
            } catch (error) {
                testResults.cors = 'error';
                updateTestCard('cors-test', 'error', `‚ùå Erro no CORS: ${error.message}`);
            }
        }
        
        function testFrontend() {
            updateTestCard('frontend-test', 'loading', 'Testando frontend...');
            
            // Simular teste de frontend
            setTimeout(() => {
                const isVercel = window.location.origin.includes('vercel.app');
                const isLocal = window.location.origin.includes('localhost');
                
                if (isVercel || isLocal) {
                    testResults.frontend = 'success';
                    updateTestCard('frontend-test', 'success', 
                        `‚úÖ Frontend funcionando!\nURL: ${window.location.origin}\nPlataforma: ${isVercel ? 'Vercel' : 'Local'}\nResponsivo: Sim`
                    );
                } else {
                    testResults.frontend = 'warning';
                    updateTestCard('frontend-test', 'warning', 
                        `‚ö†Ô∏è Frontend em ambiente desconhecido\nURL: ${window.location.origin}`
                    );
                }
            }, 1000);
        }
        
        async function testDatabase() {
            updateTestCard('database-test', 'loading', 'Testando banco de dados...');
            
            try {
                const data = await makeRequest('/products');
                const products = data.data || data;
                
                testResults.database = 'success';
                updateTestCard('database-test', 'success', 
                    `‚úÖ Banco conectado!\nProdutos: ${products.length}\nStatus: Ativo\nTipo: PostgreSQL`
                );
            } catch (error) {
                testResults.database = 'error';
                updateTestCard('database-test', 'error', `‚ùå Erro no banco: ${error.message}`);
            }
        }
        
        async function runAllTests() {
            completedTests = 0;
            updateProgress();
            
            // Executar todos os testes em sequ√™ncia
            await testAPI();
            await testAuth();
            await testProducts();
            await testCORS();
            testFrontend();
            await testDatabase();
        }
        
        function openProductionSite() {
            window.open('https://docesensacoessite.vercel.app', '_blank');
        }
        
        function generateReport() {
            const report = {
                timestamp: new Date().toISOString(),
                url: window.location.origin,
                results: testResults,
                summary: {
                    total: totalTests,
                    completed: completedTests,
                    success: Object.values(testResults).filter(r => r === 'success').length,
                    error: Object.values(testResults).filter(r => r === 'error').length,
                    warning: Object.values(testResults).filter(r => r === 'warning').length
                }
            };
            
            const reportText = `RELAT√ìRIO DE TESTE - DOCE SENS√á√ïES\n` +
                `Data: ${new Date().toLocaleString('pt-BR')}\n` +
                `URL: ${window.location.origin}\n\n` +
                `RESULTADOS:\n` +
                `- API Backend: ${testResults.api || 'N√£o testado'}\n` +
                `- Autentica√ß√£o: ${testResults.auth || 'N√£o testado'}\n` +
                `- Produtos: ${testResults.products || 'N√£o testado'}\n` +
                `- CORS: ${testResults.cors || 'N√£o testado'}\n` +
                `- Frontend: ${testResults.frontend || 'N√£o testado'}\n` +
                `- Banco de Dados: ${testResults.database || 'N√£o testado'}\n\n` +
                `RESUMO:\n` +
                `- Total de testes: ${totalTests}\n` +
                `- Completados: ${completedTests}\n` +
                `- Sucessos: ${Object.values(testResults).filter(r => r === 'success').length}\n` +
                `- Erros: ${Object.values(testResults).filter(r => r === 'error').length}\n` +
                `- Avisos: ${Object.values(testResults).filter(r => r === 'warning').length}`;
            
            // Criar arquivo de download
            const blob = new Blob([reportText], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `teste-doce-sensacoes-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            window.URL.revokeObjectURL(url);
        }
        
        // Executar testes autom√°ticos ao carregar
        window.onload = function() {
            setTimeout(runAllTests, 1000);
        };
    </script>
</body>
</html> 